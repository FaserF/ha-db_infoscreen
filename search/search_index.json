{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"DB Infoscreen for Home Assistant \ud83d\ude86","text":""},{"location":"#project-status","title":"\ud83d\udcca Project Status","text":"Component Status Latest Release Date Integration Backend API"},{"location":"#purpose-motivation","title":"\ud83c\udfaf Purpose &amp; Motivation","text":"<p>db-infoscreen brings the experience of a physical station departure board into your smart home.</p> <p>In the world of home automation, most \"Public Transport\" integrations focus on Routing (how to get from A to B). However, for many users\u2014especially those living near a station\u2014the more important question is:</p> <p>\"I know where I'm going, I just need to know if the next train is on time.\"</p> <p>This integration is designed for:</p> <ul> <li> <p> Wall-mounted Dashboards     ---     Perfect for hallway tablets or kitchen kiosks.</p> </li> <li> <p> Magic Mirrors     ---     At-a-glance information while getting ready.</p> </li> <li> <p> Commuter Checks     ---     Quickly check if your S-Bahn is delayed before leaving the house.</p> </li> </ul>"},{"location":"#the-evolution-legacy-vs-modernity","title":"\ud83d\udcdc The Evolution: Legacy vs. Modernity","text":"<p>This project did not appear in a vacuum. It is the result of years of iteration and a fundamental shift in how we handle train data in Home Assistant.</p>"},{"location":"#the-legacy-ha-deutschebahn-ha-bahnvorhersage","title":"\ud83e\udea6 The Legacy: <code>ha-deutschebahn</code> &amp; <code>ha-bahnvorhersage</code>","text":"<p>If you have been a Home Assistant user in Germany for a while, you might remember ha-deutschebahn or ha-bahnvorhersage.</p> <p>Why do these projects no longer exist/receive updates?</p> <ol> <li>Parsing/Scraping Nightmares: These older integrations relied on \"web scraping\"\u2014meaning they downloaded the HTML of public websites and tried to find the departure times in the code. Every time Deutsche Bahn changed a single line of CSS or HTML, the integration would break for everyone.</li> <li>Unreliability: Scraping is inherently fragile. It led to frequent \"Unknown\" states, broken sensors, and high maintenance overhead.</li> <li>Complexity of Routing: They tried to solve routing (finding connections between two points). This requires complex session management and handling of many edge cases that the public-facing websites weren't designed to provide via simple GET requests.</li> <li>IP Bans: Automated scraping is often detected and blocked by providers, leading to users getting temporarily banned from accessing train data.</li> </ol>"},{"location":"#the-solution-ha-db_infoscreen","title":"\ud83d\ude80 The Solution: <code>ha-db_infoscreen</code>","text":"<p><code>ha-db_infoscreen</code> was born from the realization that we needed an API-first approach. By leveraging the incredible db-fakedisplay project as a backend, we moved away from fragile scraping and towards structured data.</p> <ul> <li>Backend Stability: We use the IRIS-TTS API\u2014the same data source that powers actual platform displays at German stations.</li> <li>No Scraping: We receive clean JSON data. No more broken sensors because of a website redesign.</li> <li>Focus on Departures: By specializing in \"Station Departure Boards\", we provide the most reliable and information-dense experience for your dashboard.</li> </ul>"},{"location":"#credits-acknowledgments","title":"\u2764\ufe0f Credits &amp; Acknowledgments","text":"<p>This project is a bridge between the Home Assistant ecosystem and the wider open-source world.</p> <p>Project Hero: derf</p> <p>A massive amount of credit goes to derf for his tireless work on db-fakedisplay.</p> <p>His backend project does the \"heavy lifting\": aggregating data from dozens of European transport associations (DB, \u00d6BB, SBB, and many more) and providing a unified, stable API. Without his work, this integration would not be possible. Please consider starring his repository!</p>"},{"location":"#key-features","title":"\u2728 Key Features","text":"Feature Description Real-time Data Live delays, platform changes, and quality notes (e.g., \"Train reversed\"). Global Coverage Supports DB (Germany), \u00d6BB (Austria), SBB (Switzerland), and many local associations. Smart Filtering Exclude cancelled trains, filter by direction, or show only specific platforms. Deep Attributes Access route info, warnings, messages, and train composition details. ePaper Ready Built-in \"Text View\" mode for ESPHome/ePaper displays."},{"location":"#getting-started","title":"\ud83d\ude80 Getting Started","text":"<p>Install with HACS View Settings</p>"},{"location":"advanced/","title":"Advanced Usage \ud83d\ude80","text":"<p>For users who want to push the boundaries of their Home Assistant dashboard, <code>ha-db_infoscreen</code> provides several advanced features.</p>"},{"location":"advanced/#templating-logic","title":"\ud83d\udee0\ufe0f Templating &amp; Logic","text":"<p>The sensor stores its main payload in the <code>departures</code> attribute as a JSON list. This makes it incredibly easy to use Jinja2 templates for custom notifications or cards.</p>"},{"location":"advanced/#example-delay-notification","title":"Example: Delay Notification","text":"<p>Trigger an automation only if the next train toward \"Mainz\" is delayed by more than 10 minutes.</p> <p>{% raw %} <pre><code>automation:\n  - alias: \"Commuter Delay Alert\"\n    trigger:\n      - platform: template\n        value_template: &gt;\n          {% set trains = state_attr('sensor.my_station', 'departures') %}\n          {% if trains %}\n            {{ (trains | selectattr('destination', 'search', 'Mainz') | first).delayDeparture | int &gt; 10 }}\n          {% else %}\n            false\n          {% endif %}\n    action:\n      - service: notify.mobile_app\n        data:\n          title: \"\ud83d\ude86 Train Delay!\"\n          message: \"The next train to Mainz is delayed by {{ (state_attr('sensor.my_station', 'departures') | selectattr('destination', 'search', 'Mainz') | first).delayDeparture }} minutes.\"\n</code></pre></p>"},{"location":"advanced/#self-hosting-the-backend","title":"\ud83d\udce1 Self-Hosting the Backend","text":"<p>If you have a high number of sensors or want maximum privacy, you can host your own instance of the db-fakedisplay API.</p>"},{"location":"advanced/#docker-compose-example","title":"Docker Compose Example","text":"<pre><code>services:\n  dbf:\n    image: derf/db-fakedisplay:latest\n    ports:\n      - \"8080:8080\"\n    restart: always\n</code></pre> <p>Once running, update the Custom API URL in the integration settings to: <code>http://&lt;your-ip&gt;:8080</code></p>"},{"location":"advanced/#automated-api-tracking","title":"\ud83e\udd16 Automated API Tracking","text":"<p>A unique feature of this project is its tight integration with the upstream backend. -   The Version File: We maintain a <code>.backend_version</code> file in our repository. -   Renovate: Our CI system (Renovate) monitors the <code>derf/db-fakedisplay</code> project for releases. -   Automatic Verification: When a new version is released, Renovate creates a PR to update our tracked version. This triggers our GitHub Actions to run the full suite of stability tests against the new backend logic before you even receive an update. -   Reliability: This ensures that <code>ha-db_infoscreen</code> remains compatible with backend changes without manual intervention.</p>"},{"location":"configuration/","title":"Configuration Reference \u2699\ufe0f","text":"<p><code>ha-db_infoscreen</code> provides a multi-layered configuration system. You can set up basic sensors quickly or dive deep into filtering logic.</p>"},{"location":"configuration/#initial-configuration-the-wizard","title":"\ud83c\udfd7\ufe0f Initial Configuration (The Wizard)","text":"<p>When you first add a \"DB Infoscreen\" integration, you meet the setup wizard. This creates the \"Base Sensor\".</p>"},{"location":"configuration/#1-station-selection","title":"1. Station Selection","text":"<ul> <li>What to enter: You can enter a full name (e.g. <code>Frankfurt am Main Hbf</code>), a DS100 ID (e.g. <code>FF</code>), or a Trip Number.</li> <li>DS100 Advantage: Using a DS100 ID is faster and more precise. It avoids ambiguity when multiple cities have similar station names.</li> </ul>"},{"location":"configuration/#2-data-source","title":"2. Data Source","text":"<p>Select the backend provider. -   IRIS-TTS: The default and most reliable source for German stations. It provides high-frequency updates and quality notes. -   Regional/International: Select providers like <code>\u00d6BB</code>, <code>SBB</code>, or regional networks when tracking trains outside Germany or on specific local lines not covered by the main DB IRIS system.</p>"},{"location":"configuration/#options-flow-fine-tuning","title":"\ud83d\udee0\ufe0f Options Flow (Fine Tuning)","text":"<p>Once a sensor is created, click Configure on the integration card to access granular settings. These are categorized into meaningful groups.</p>"},{"location":"configuration/#general-options","title":"General Options","text":"<ul> <li>Update Interval: Default is 3 minutes. Lowering this to 1 minute provides near-instant delay updates but increases API load.</li> <li>Offset (HH:MM): Shift the search window into the future.<ul> <li>Example: Use <code>00:15</code> if you want to skip all trains leaving in the next 15 minutes because you haven't left the house yet.</li> </ul> </li> <li>Number of Departures: Controls how many entries are stored in the <code>departures</code> attribute. Increasing this (e.g. to 15) gives more historical/future visibility but increases state size.</li> </ul>"},{"location":"configuration/#filter-options","title":"Filter Options","text":"<p>This is where the magic happens for commuters.</p> <p>Delimiter Rule</p> <p>Always use a comma <code>,</code> to separate multiple values in text fields.</p> <ul> <li>Platforms: Enter a list of tracks you care about (e.g. <code>4, 5, 21</code>).</li> <li>Via Stations: This is an OR filter.<ul> <li>Example: <code>K\u00f6ln, D\u00fcsseldorf</code>. The sensor will show any train that stops at EITHER Cologne OR D\u00fcsseldorf.</li> </ul> </li> <li>Direction: A substring search for the destination.<ul> <li>Example: Entering <code>Paris</code> will catch <code>Paris Gare du Nord</code> and <code>Paris Est</code>.</li> </ul> </li> <li>Excluded Directions: Hide specific destinations. Useful for stations where many lines overlap.</li> <li>Exclude Cancelled Trains:<ul> <li><code>True</code>: Cancelled trains vanish from your dashboard entirely.</li> <li><code>False</code> (Default): Cancelled trains stay in the list (marked as <code>isCancelled: true</code>), allowing you to see why your commute is broken.</li> </ul> </li> </ul>"},{"location":"configuration/#display-options","title":"Display Options","text":"<ul> <li>Detailed Information: Enables extra JSON metadata in attributes.</li> <li>Preferred Time Mode:<ul> <li><code>Departure</code>: Default. Focuses on when the train leaves.</li> <li><code>Arrival</code>: Useful if you are using the integration to track when someone is arriving at your station.</li> </ul> </li> <li>Enable Text View: A powerful feature for ePaper displays. It compiles the most important info into a single formatted string.</li> <li>Hide Low Delay: Removes delay noise for delays less than 5 minutes.</li> </ul>"},{"location":"configuration/#advanced-options","title":"Advanced Options","text":"<ul> <li>Custom API URL: Essential if you are hosting your own db-fakedisplay instance.</li> <li>Deduplication: Filters out redundant entries. Some data sources report the same train twice under different IDs; this keeps your UI clean.</li> <li>Keep Route: Normally, only the destination is stored. Enable this to keep the entire list of intermediate stops.</li> <li>Past 60 Minutes: Include trains that have already left in the last hour. Great for \"What did I miss?\" views.</li> </ul>"},{"location":"development/","title":"Development &amp; Contributing \ud83d\udc69\u200d\ud83d\udcbb","text":"<p>Thank you for your interest in improving <code>ha-db_infoscreen</code>! This guide explains how to set up your environment, run tests, and contribute changes.</p>"},{"location":"development/#local-environment-setup","title":"\ud83d\udee0\ufe0f Local Environment Setup","text":"<p>To get started with development, you'll need Python 3.12+ installed.</p> <ol> <li> <p>Clone the repository:     <pre><code>git clone https://github.com/FaserF/ha-db_infoscreen.git\ncd ha-db_infoscreen\n</code></pre></p> </li> <li> <p>Create a virtual environment:     <pre><code>python -m venv venv\nsource venv/bin/activate  # On Windows: venv\\Scripts\\activate\n</code></pre></p> </li> <li> <p>Install dependencies:     <pre><code>pip install -r requirements_test.txt\npip install -r custom_components/db_infoscreen/requirements.txt\n</code></pre></p> </li> </ol>"},{"location":"development/#testing","title":"\ud83e\uddea Testing","text":"<p>We value stability. All Pull Requests must pass our automated test suite.</p>"},{"location":"development/#running-tests","title":"Running Tests","text":"<p>We use <code>pytest</code> for all tests. <pre><code>pytest\n</code></pre></p>"},{"location":"development/#key-test-suites","title":"Key Test Suites","text":"<ul> <li><code>tests/test_config_flow.py</code>: Verifies the setup wizard and options menu.</li> <li><code>tests/test_stability.py</code>: Ensures the integration handles API errors and malformed data gracefully.</li> <li><code>tests/test_translations.py</code>: Checks for consistency across all language files.</li> </ul>"},{"location":"development/#cicd-renovate","title":"\ud83e\udd16 CI/CD &amp; Renovate","text":"<p>We use GitHub Actions to automate our quality control and deployment.</p>"},{"location":"development/#automated-api-validation","title":"Automated API Validation","text":"<p>Our <code>backend-api-update.yml</code> workflow is a unique \"early warning system\". 1.  Renovate monitors the db-fakedisplay project. 2.  When a new backend version is released, Renovate opens a PR updating our <code>.backend_version</code>. 3.  The CI automatically runs our stability tests against this new version. 4.  If it passes, we know the integration is safe to use with the new backend.</p>"},{"location":"development/#documentation-deployment","title":"Documentation Deployment","text":"<p>The documentation (this site!) is automatically built and deployed to GitHub Pages whenever changes are pushed to <code>main</code>.</p>"},{"location":"development/#translations","title":"\ud83c\udf0d Translations","text":"<p>Help us reach more users by contributing translations!</p> <ol> <li>Add your language code to <code>custom_components/db_infoscreen/translations/</code> (e.g., <code>fr.json</code>).</li> <li>Use <code>en.json</code> or <code>de.json</code> as a template.</li> <li>Run <code>pytest tests/test_translations.py</code> to ensure all keys are present.</li> </ol>"},{"location":"development/#pull-request-guidelines","title":"\ud83d\udcdc Pull Request Guidelines","text":"<ol> <li>Issue First: For major changes, please open an issue first to discuss your proposal.</li> <li>Formatting: We use <code>black</code> for code formatting and <code>ruff</code> for linting.</li> <li>Documentation: If you add a new feature, please update the relevant <code>.md</code> file in the <code>docs/</code> folder.</li> </ol>"},{"location":"installation/","title":"Installation","text":"<p>You can install <code>ha-db_infoscreen</code> via HACS (recommended) or manually.</p>"},{"location":"installation/#option-1-hacs-recommended","title":"Option 1: HACS (Recommended)","text":"<p>The easiest way to install and manage updates.</p> <ol> <li>Open your Home Assistant instance.</li> <li>Go to HACS &gt; Integrations.</li> <li>Click the + Explore &amp; Download Repositories button.</li> <li>Search for <code>db-infoscreen</code>.</li> <li>Click Download.</li> <li>Restart Home Assistant.</li> </ol> <p></p> <p>Why HACS?</p> <p>HACS handles updates for you, ensuring you always have the latest fixes (like API URL changes) and features.</p>"},{"location":"installation/#option-2-manual-installation","title":"Option 2: Manual Installation","text":"<p>If you prefer not to use HACS:</p> <ol> <li>Download the latest release zip from the GitHub Releases page.</li> <li>Unzip the file.</li> <li>Copy the <code>db_infoscreen</code> directory into your Home Assistant's <code>custom_components</code> directory:     <pre><code>/config/custom_components/db_infoscreen\n</code></pre></li> <li>Restart Home Assistant.</li> </ol>"},{"location":"installation/#post-installation","title":"Post-Installation","text":"<p>Once installed (and after a restart), you need to add the integration to your instance:</p> <ol> <li>Navigate to Settings &gt; Devices &amp; Services.</li> <li>Click + Add Integration.</li> <li>Search for DB Infoscreen.</li> <li>Follow the setup wizard to configure your first station.</li> </ol> <p></p>"},{"location":"limitations/","title":"Limitations \u26a0\ufe0f","text":"<p>While <code>ha-db_infoscreen</code> is a powerful tool, it operates within certain technical and administrative constraints. Understanding these will help you set realistic expectations for your dashboard.</p>"},{"location":"limitations/#api-rate-limits","title":"\ud83d\udea6 API Rate Limits","text":"<p>The primary constraint for most users is the rate-limiting imposed by the public Backend API (IRIS-TTS).</p>"},{"location":"limitations/#sensor-count","title":"Sensor Count","text":"<p>By default, the integration is configured to support a maximum of 30 sensors per Home Assistant instance. -   Why?: Every sensor performs its own API calls. A single station might result in multiple calls (IRIS + HAFAS + Quality). To prevent the public infrastructure from being overwhelmed (which could lead to a permanent IP ban for you), we enforce this limit. -   Host your own: If you need more than 30 sensors, you must host your own instance of the db-fakedisplay backend.</p>"},{"location":"limitations/#update-frequency","title":"Update Frequency","text":"<p>The minimum update interval is 1 minute. -   Why?: Train data generally doesn't change every few seconds. Requesting data more frequently is counter-productive and puts unnecessary strain on the servers.</p>"},{"location":"limitations/#hardware-database-constraints","title":"\ud83d\udcbe Hardware &amp; Database Constraints","text":"<p>Because this integration provides rich metadata (attributes), it can impact your Home Assistant host's resources.</p>"},{"location":"limitations/#state-storage-the-recorder","title":"State Storage (The Recorder)","text":"<p>If you enable features like \"Detailed Information\" or \"Keep Route\", the sensor attributes will contain large JSON objects. -   The Risk: These attributes are saved to your Home Assistant database (<code>home-assistant_v2.db</code>) every time the sensor updates. Over weeks and months, this can lead to a massive database file, potentially slowing down backups or wearing out SD cards on Raspberry Pi devices. -   Recommendation:   - Only enable \"Keep Route\" if you are actively using that data in a custom card.   - Consider excluding these sensors from your Recorder configuration.</p>"},{"location":"limitations/#memory-consumption","title":"Memory Consumption","text":"<p>On low-end hardware (like the Raspberry Pi 3), having 30+ sensors with detailed route tracking enabled can consume a noticeable amount of RAM. Ensure your hardware is sized appropriately for your configuration.</p>"},{"location":"limitations/#data-accuracy-scope","title":"\ud83d\ude82 Data Accuracy &amp; Scope","text":"<p>The integration is only as good as the data it receives from the transport associations.</p>"},{"location":"limitations/#ghost-trains","title":"\"Ghost\" Trains","text":"<p>Occasionally, the API might report a train that has been cancelled but the cancellation hasn't propagated through the various transit systems yet. This is an upstream issue and cannot be fixed within the integration.</p>"},{"location":"limitations/#coverage-gaps","title":"Coverage Gaps","text":"<p>While the backend supports dozens of providers, not all providers offer the same level of detail. -   IRIS-TTS: Highly detailed (platform changes, quality notes). -   Some HAFAS backends: May only provide basic arrival/departure times without platform info or delay reasons.</p>"},{"location":"limitations/#routing-vs-departures","title":"Routing vs. Departures","text":"<p>This integration is not a router. It will not tell you which train to take to reach a specific destination if that involves changes. It only tells you what is leaving the current station.</p> How to replicate 'Routing'? <p>You can use the Via Stations filter to see only trains reaching your destination, but for complex trips with multiple transfers, you are better served by a dedicated routing integration or the official DB Navigator app.</p>"},{"location":"troubleshooting/","title":"Troubleshooting &amp; Support \ud83d\udee0\ufe0f","text":"<p>If things aren't working as expected, follow this guide to identify and resolve the issue.</p>"},{"location":"troubleshooting/#common-issues","title":"\ud83d\udd0d Common Issues","text":""},{"location":"troubleshooting/#no-data-or-unavailable","title":"\"No Data\" or <code>Unavailable</code>","text":"<ul> <li>Check Logs: Go to Settings &gt; System &gt; Logs. Look for errors related to <code>db_infoscreen</code>.</li> <li>API Limit: Are you using more than 30 sensors? You might be rate-limited by the public API.</li> <li>Station Name: Ensure the station name is spelled correctly or use the DS100 ID.</li> </ul>"},{"location":"troubleshooting/#values-are-not-persisting","title":"Values are not persisting","text":"<p>If you change a setting in the \"Options\" menu and it doesn't seem to take effect: -   Fixed (v2026.1.1+): Ensure you are using commas <code>,</code> to separate multiple stations or platforms. Old versions used pipes <code>|</code>, which are no longer supported in the UI.</p>"},{"location":"troubleshooting/#delays-are-missing","title":"Delays are missing","text":"<p>The availability of real-time delay data depends on the Data Source. -   IRIS-TTS provides the best live data for Germany. -   Regional HAFAS sources might only update delays every few minutes or not at all for certain train types.</p>"},{"location":"troubleshooting/#debug-logging","title":"\ud83d\udcdd Debug Logging","text":"<p>To help developers diagnose complex issues, please provide debug logs.</p> <ol> <li>Add the following to your <code>configuration.yaml</code>:     <pre><code>logger:\n  default: info\n  logs:\n    custom_components.db_infoscreen: debug\n</code></pre></li> <li>Restart Home Assistant.</li> <li>Observe the issues and copy the relevant logs from the System Logs.</li> </ol>"},{"location":"troubleshooting/#community-support","title":"\ud83d\udcac Community &amp; Support","text":"<ul> <li>Issues: Report bugs or request features on GitHub Issues.</li> <li>Discussions: Check the GitHub Discussions (if enabled) or community forums for setup help.</li> </ul> <p>Need Help?</p> <p>When opening an issue, please always include your Diagnostic Information (available on the Integration entry via the three-dot menu).</p>"}]}